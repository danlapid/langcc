cmake_minimum_required(VERSION 3.13.4) # 3.13.4 comes from https://llvm.org/docs/CMake.html#embedding-llvm-in-your-project
project(langcc VERSION 1.0.0)
set (PROJECT_SUMMARY "A Next-Generation Compiler Compiler")
# C++ standard requirements
set(CMAKE_CXX_STANDARD 17)

#
# Set include directories
#
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/src ${CMAKE_CURRENT_SOURCE_DIR}/gen)
add_compile_definitions(__CC__=${CMAKE_CXX_COMPILER})
#
# Create datacc target
#
add_executable(datacc
  ${CMAKE_CURRENT_SOURCE_DIR}/src/datacc.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/gen/cc__gen.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/gen/data__gen.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/datacc_main.cpp
)

#
# Files generated by datacc
#
add_custom_command(
    COMMAND ${CMAKE_CURRENT_BINARY_DIR}/datacc ${CMAKE_CURRENT_SOURCE_DIR}/src/common.data ${CMAKE_CURRENT_SOURCE_DIR}/gen
    DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/datacc ${CMAKE_CURRENT_SOURCE_DIR}/src/common.data
    OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/gen/common__data_gen.cpp
)

#
# Create langcc target
#
add_executable(langcc
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_lexer.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_parser_flatten.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_parser_attr.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_parser_cps.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_parser_lr.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_encode.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_normalize.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_emit.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/gen/cc__gen.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/gen/data__gen.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/gen/meta__gen.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/gen/common__data_gen.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/datacc.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/src/langcc_main.cpp
)
